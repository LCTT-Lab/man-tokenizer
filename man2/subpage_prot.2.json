[
  {
    "type": "comment",
    "lines": [
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Copyright (c) 2010 Michael Kerrisk <mtk.manpages@gmail.com>"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" based on a proposal from Stephan Mueller <smueller@atsec.com>"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" %%%LICENSE_START(VERBATIM)"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Permission is granted to make and distribute verbatim copies of this"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" manual provided the copyright notice and this permission notice are"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" preserved on all copies."
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Permission is granted to copy and distribute modified versions of"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" this manual under the conditions for verbatim copying, provided that"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" the entire resulting derived work is distributed under the terms of"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" a permission notice identical to this one."
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Since the Linux kernel and libraries are constantly changing, this"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" manual page may be incorrect or out-of-date.  The author(s) assume"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" no responsibility for errors or omissions, or for damages resulting"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" from the use of the information contained herein.  The author(s) may"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" not have taken the same level of care in the production of this"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" manual, which is licensed free of charge, as they might when working"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" professionally."
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Formatted or processed versions of this manual, if unaccompanied by"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" the source, must acknowledge the copyright and authors of this work."
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" %%%LICENSE_END"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" Various pieces of text taken from the kernel source and the commentary"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" in kernel commit fa28237cfcc5827553044cbd6ee52e33692b0faa"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" both written by Paul Mackerras <paulus@samba.org>"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\""
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".TH",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " SUBPAGE_PROT 2 2017-09-15 \"Linux\" \"Linux Programmer's Manual\""
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " NAME"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "subpage_prot "
        },
        {
          "type": "ESCAPE",
          "content": "\\-"
        },
        {
          "type": "TEXT",
          "content": " define a subpage protection for an address range"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " SYNOPSIS"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".nf",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".BI",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " \"long subpage_prot(unsigned long \" addr \", unsigned long \" len ,"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".BI",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " \"                  uint32_t *\" map \");"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".fi",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".PP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".IR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " Note :"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "There is no glibc wrapper for this system call; see NOTES."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " DESCRIPTION"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "The PowerPC-specific"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " subpage_prot ()"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "system call provides the facility to control the access"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "permissions on individual 4"
        },
        {
          "type": "ESCAPE",
          "content": "\\ "
        },
        {
          "type": "TEXT",
          "content": "kB subpages on systems configured with"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "a page size of 64"
        },
        {
          "type": "ESCAPE",
          "content": "\\ "
        },
        {
          "type": "TEXT",
          "content": "kB."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".PP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "The protection map is applied to the memory pages in the region starting at"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " addr"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "and continuing for"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " len"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "bytes."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Both of these arguments must be aligned to a 64-kB boundary."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".PP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "The protection map is specified in the buffer pointed to by"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".IR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " map ."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "The map has 2 bits per 4"
        },
        {
          "type": "ESCAPE",
          "content": "\\ "
        },
        {
          "type": "TEXT",
          "content": "kB subpage;"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "thus each 32-bit word specifies the protections of 16 4"
        },
        {
          "type": "ESCAPE",
          "content": "\\ "
        },
        {
          "type": "TEXT",
          "content": "kB subpages"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "inside a 64"
        },
        {
          "type": "ESCAPE",
          "content": "\\ "
        },
        {
          "type": "TEXT",
          "content": "kB page"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "(so, the number of 32-bit words pointed to by"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " map"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "should equate to the number of 64-kB pages specified by"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".IR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " len )."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Each 2-bit field in the protection map is either 0 to allow any access,"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "1 to prevent writes, or 2 or 3 to prevent all accesses."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " RETURN VALUE"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "On success,"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " subpage_prot ()"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "returns 0."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Otherwise, one of the error codes specified below is returned."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " ERRORS"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".TP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".B",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " EFAULT"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "The buffer referred to by"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " map"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "is not accessible."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".TP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".B",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " EINVAL"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "The"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " addr"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "or"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".I",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " len"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "arguments are incorrect."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Both of these arguments must be aligned to a multiple of the system page size,"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "and they must not refer to a region outside of the"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "address space of the process or to a region that consists of huge pages."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".TP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".B",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " ENOMEM"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Out of memory."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " VERSIONS"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "This system call is provided on the PowerPC architecture"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "since Linux 2.6.25."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "The system call is provided only if the kernel is configured with"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " CONFIG_PPC_64K_PAGES ."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "No library support is provided."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " CONFORMING TO"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "This system call is Linux-specific."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " NOTES"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "Glibc does not provide a wrapper for this system call; call it using"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " syscall (2)."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".PP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "Normal page protections (at the 64-kB page level) also apply;"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "the subpage protection mechanism is an additional constraint,"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "so putting 0 in a 2-bit field won't allow writes to a page that is otherwise"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "write-protected."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SS",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " Rationale"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "TEXT",
          "content": "This system call is provided to assist writing emulators that"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "operate using 64-kB pages on PowerPC systems."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "When emulating systems such as x86, which uses a smaller page size,"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "the emulator can no longer use the memory-management unit (MMU)"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "and normal system calls for controlling page protections."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "(The emulator could emulate the MMU by checking and possibly remapping"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "the address for each memory access in software, but that is slow.)"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "The idea is that the emulator supplies an array of protection masks"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "to apply to a specified range of virtual addresses."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "These masks are applied at the level where hardware page-table entries (PTEs)"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "are inserted into the hardware page table based on the Linux PTEs,"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "so the Linux PTEs are not affected."
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "Implicit in this is that the regions of the address space that are"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "protected are switched to use 4-kB hardware pages rather than 64-kB"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "hardware pages (on machines with hardware 64-kB page support)."
        }
      ]
    ]
  },
  {
    "type": "comment",
    "lines": [
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" In the initial implementation, it was the case that:"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\"     In fact the whole process is switched to use 4 kB hardware pages when the"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\"     subpage_prot system call is used, but this could be improved in future"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\"     to switch only the affected segments."
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" But Paul Mackerass says (Oct 2010): I'm pretty sure we now only switch"
        }
      ],
      [
        {
          "type": "COMMENT_BLOCK",
          "content": ".\\\" the affected segment, not the whole process."
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".SH",
          "translatable": true
        },
        {
          "type": "TEXT",
          "content": " SEE ALSO"
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " mprotect (2),"
        }
      ],
      [
        {
          "type": "MACRO_INLINE",
          "content": ".BR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " syscall (2)"
        }
      ]
    ]
  },
  {
    "type": "macro",
    "lines": [
      [
        {
          "type": "MACRO_BLOCK",
          "content": ".PP",
          "translatable": false
        }
      ]
    ]
  },
  {
    "type": "content",
    "lines": [
      [
        {
          "type": "MACRO_INLINE",
          "content": ".IR",
          "translatable": false
        },
        {
          "type": "TEXT",
          "content": " Documentation/admin-guide/mm/hugetlbpage.rst"
        }
      ],
      [
        {
          "type": "TEXT",
          "content": "in the Linux kernel source tree"
        }
      ]
    ]
  }
]
